# 9. ì‹ í˜¸ì™€ ì˜ˆì™¸ ì²˜ë¦¬

## 9.1 `signal()`, `sigaction()` ì‚¬ìš©ë²•

### ê°œìš”

**Signal(ì‹œê·¸ë„)** ì€ ë¦¬ëˆ…ìŠ¤/ìœ ë‹‰ìŠ¤ì—ì„œ **ë¹„ë™ê¸°ì ì¸ ì´ë²¤íŠ¸ ì•Œë¦¼ ë©”ì»¤ë‹ˆì¦˜**ì´ë‹¤.
 â†’ ì»¤ë„ ë˜ëŠ” ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ê°€ **í˜„ì¬ í”„ë¡œì„¸ìŠ¤ì— íŠ¹ì • ì´ë²¤íŠ¸ê°€ ë°œìƒí–ˆìŒì„ ì•Œë¦´ ë•Œ** ì‚¬ìš©í•œë‹¤.

#### ì£¼ìš” ìš©ë„

- í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ ìš”ì²­ (ex: `SIGTERM`, `SIGKILL`)
- ì‚¬ìš©ì ì¸í„°ëŸ½íŠ¸ (ex: `SIGINT` â†’ Ctrl+C)
- ì•ŒëŒ/íƒ€ì´ë¨¸ ì´ë²¤íŠ¸ (ex: `SIGALRM`)
- ìì‹ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ ì•Œë¦¼ (ex: `SIGCHLD`)
- ì‚¬ìš©ì ì •ì˜ ì‹œê·¸ë„ (ex: `SIGUSR1`, `SIGUSR2`)

#### ê¸°ë³¸ íë¦„

- íŠ¹ì • ì‹œê·¸ë„ì´ í”„ë¡œì„¸ìŠ¤ì— ì „ë‹¬ â†’ ì»¤ë„ì´ í”„ë¡œì„¸ìŠ¤ì˜ ì‹œê·¸ë„ í•¸ë“¤ëŸ¬ í˜¸ì¶œ â†’ ì§€ì • ë™ì‘ ìˆ˜í–‰.

------

### 1ï¸âƒ£ Signal ì¢…ë¥˜ ì˜ˆì‹œ

| Signal  | ë²ˆí˜¸ | ê¸°ë³¸ ë™ì‘        | ì„¤ëª…                              |
| ------- | ---- | ---------------- | --------------------------------- |
| SIGINT  | 2    | Terminate        | Ctrl+C ì…ë ¥ ì‹œ ë°œìƒ               |
| SIGTERM | 15   | Terminate        | ì¼ë°˜ ì¢…ë£Œ ìš”ì²­                    |
| SIGKILL | 9    | Terminate (ê°•ì œ) | ê°•ì œ ì¢…ë£Œ (ë¬´ì‹œ ë¶ˆê°€)             |
| SIGSTOP | 19   | Stop             | í”„ë¡œì„¸ìŠ¤ ì¼ì‹œ ì¤‘ì§€ (ë¬´ì‹œ ë¶ˆê°€)    |
| SIGCONT | 18   | Continue         | ì¤‘ì§€ëœ í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰ ì¬ê°œ         |
| SIGALRM | 14   | Terminate        | `alarm()` í•¨ìˆ˜ì— ì˜í•´ ë°œìƒ        |
| SIGCHLD | 17   | Ignore           | ìì‹ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ ì‹œ ë¶€ëª¨ì— ì „ë‹¬ |
| SIGUSR1 | 10   | Terminate        | ì‚¬ìš©ì ì •ì˜ ì‹œê·¸ë„ 1              |
| SIGUSR2 | 12   | Terminate        | ì‚¬ìš©ì ì •ì˜ ì‹œê·¸ë„ 2              |

------

### 2ï¸âƒ£ ì‹œê·¸ë„ ì²˜ë¦¬ ë°©ë²•

#### 1ï¸âƒ£ Default handler

- ì•„ë¬´ ì„¤ì • ì•ˆ í•˜ë©´ ì‹œê·¸ë„ì˜ **ê¸°ë³¸ ë™ì‘**ì´ ì‹¤í–‰ë¨.
  - ëŒ€ë¶€ë¶„ Terminate / Ignore.

#### 2ï¸âƒ£ Custom handler

- í”„ë¡œê·¸ë˜ë¨¸ê°€ ì§ì ‘ í•¸ë“¤ëŸ¬ í•¨ìˆ˜ ì§€ì • ê°€ëŠ¥.
- ëŒ€í‘œ API:
  - `signal()`
  - `sigaction()` (ë” ì•ˆì „í•˜ê³  ê¸°ëŠ¥ ê°•ë ¥í•¨ â†’ ê¶Œì¥)

------

### 3ï¸âƒ£ signal()

#### ì›í˜•

```
#include <signal.h>

typedef void (*sighandler_t)(int);

sighandler_t signal(int signum, sighandler_t handler);
```

#### handler ì¸ì

- `handler` í•¨ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜:

```
void handler(int signum);
```

- `signum` â†’ ìˆ˜ì‹ í•œ ì‹œê·¸ë„ ë²ˆí˜¸.

#### ì˜ˆì œ

```
#include <stdio.h>
#include <signal.h>

void my_handler(int signum) {
    printf("Received signal %d\n", signum);
}

int main() {
    signal(SIGINT, my_handler);

    while (1) {
        printf("Running...\n");
        sleep(1);
    }

    return 0;
}
```

â†’ ì‹¤í–‰ í›„ **Ctrl+C** ì…ë ¥ ì‹œ:

```
Running...
Running...
Received signal 2
```

------

### 4ï¸âƒ£ sigaction()

#### ì›í˜•

```
#include <signal.h>

int sigaction(int signum, const struct sigaction *act, struct sigaction *oldact);
```

#### struct sigaction

```
struct sigaction {
    void     (*sa_handler)(int);        // ê°„ë‹¨ í•¸ë“¤ëŸ¬ ë“±ë¡
    void     (*sa_sigaction)(int, siginfo_t *, void *); // ê³ ê¸‰ í•¸ë“¤ëŸ¬
    sigset_t sa_mask;                  // ì‹œê·¸ë„ ë¸”ë¡ ë§ˆìŠ¤í¬
    int      sa_flags;                 // ì˜µì…˜ ì„¤ì •
    void     (*sa_restorer)(void);     // obsolete
};
```

â†’ ê¸°ë³¸ì ìœ¼ë¡œ `sa_handler` ì‚¬ìš©.

#### sa_flags ì£¼ìš” ì˜µì…˜

| ì˜µì…˜       | ì„¤ëª…                                                   |
| ---------- | ------------------------------------------------------ |
| SA_RESTART | ì‹œê·¸ë„ ì²˜ë¦¬ í›„ ìë™ìœ¼ë¡œ interrupted system call ì¬ì‹œë„ |
| SA_SIGINFO | ê³ ê¸‰ í•¸ë“¤ëŸ¬ ì‚¬ìš© (`sa_sigaction`) í™œì„±í™”               |

------

#### ê¸°ë³¸ ì‚¬ìš© ì˜ˆì œ (sa_handler)

```
#include <stdio.h>
#include <signal.h>
#include <unistd.h>

void my_handler(int signum) {
    printf("SIGACTION: received signal %d\n", signum);
}

int main() {
    struct sigaction sa;
    sa.sa_handler = my_handler;
    sigemptyset(&sa.sa_mask);
    sa.sa_flags = SA_RESTART;

    sigaction(SIGINT, &sa, NULL);

    while (1) {
        printf("Running...\n");
        sleep(1);
    }

    return 0;
}
```

â†’ ì‹¤í–‰ í›„ **Ctrl+C** ì…ë ¥ ì‹œ:

```
Running...
Running...
SIGACTION: received signal 2
```

------

#### ê³ ê¸‰ í•¸ë“¤ëŸ¬ ì‚¬ìš© ì˜ˆì œ (sa_sigaction)

```
#include <stdio.h>
#include <signal.h>
#include <unistd.h>

void my_handler(int signum, siginfo_t *info, void *context) {
    printf("SIGACTION(SIGINFO): received signal %d from PID %d\n", signum, info->si_pid);
}

int main() {
    struct sigaction sa;
    sa.sa_sigaction = my_handler;
    sigemptyset(&sa.sa_mask);
    sa.sa_flags = SA_SIGINFO;

    sigaction(SIGUSR1, &sa, NULL);

    while (1) {
        printf("Waiting for SIGUSR1...\n");
        sleep(1);
    }

    return 0;
}
```

```
$ ./siginfo_example
# ìƒˆ í„°ë¯¸ë„ì—ì„œ
$ kill -SIGUSR1 <PID>
```

ì¶œë ¥ ì˜ˆ:

```
Waiting for SIGUSR1...
SIGACTION(SIGINFO): received signal 10 from PID 12345
```

------

### 5ï¸âƒ£ signal() vs sigaction() ì°¨ì´ì 

| í•­ëª©        | signal()                                | sigaction()                   |
| ----------- | --------------------------------------- | ----------------------------- |
| API ë‹¨ìˆœì„±  | ê°„ë‹¨                                    | ë³µì¡ (ìœ ì—°ì„± ì œê³µ)            |
| ì¬ì§„ì… ì²˜ë¦¬ | ì‹œìŠ¤í…œë§ˆë‹¤ êµ¬í˜„ ì°¨ì´ ìˆìŒ               | SA_RESTART ì˜µì…˜ìœ¼ë¡œ ì œì–´ ê°€ëŠ¥ |
| ê³ ê¸‰ í•¸ë“¤ëŸ¬ | ë¯¸ì§€ì›                                  | `sa_sigaction` ì§€ì›           |
| ë§ˆìŠ¤í¬ ì²˜ë¦¬ | ë¯¸ì§€ì›                                  | ì§€ì› (`sa_mask`)              |
| í˜¸í™˜ì„±      | POSIXì—ì„œ deprecated ì·¨ê¸‰ â†’ ê³¼ê±° í˜¸í™˜ìš© | í˜„ì¬ í‘œì¤€, ê¶Œì¥ API           |

â†’ **ì‹¤ì „ì—ì„œëŠ” í•­ìƒ `sigaction()` ì‚¬ìš© ê¶Œì¥**.

------

### 6ï¸âƒ£ ì‹œê·¸ë„ ë¸”ë¡ ë§ˆìŠ¤í¬

- `sa_mask` ë¥¼ ì´ìš©í•´ì„œ **ì‹œê·¸ë„ í•¸ë“¤ëŸ¬ ì‹¤í–‰ ì¤‘ ë¸”ë¡í•  ì‹œê·¸ë„ ì„¤ì • ê°€ëŠ¥**.

ì˜ˆ:

```
sigemptyset(&sa.sa_mask);
sigaddset(&sa.sa_mask, SIGTERM);  // SIGINT ì²˜ë¦¬ ì¤‘ SIGTERM ë¸”ë¡
```

â†’ SIGINT í•¸ë“¤ëŸ¬ ì‹¤í–‰ ì¤‘ì—ëŠ” SIGTERMì´ ë¸”ë¡ë¨ â†’ í•¸ë“¤ëŸ¬ ì¢…ë£Œ í›„ ì²˜ë¦¬.

------

### 7ï¸âƒ£ ì •ë¦¬

| API         | ê¸°ëŠ¥                               | ê¶Œì¥ ì‚¬ìš© ì—¬ë¶€                |
| ----------- | ---------------------------------- | ----------------------------- |
| signal()    | ê°„ë‹¨í•œ ì‹œê·¸ë„ í•¸ë“¤ëŸ¬ ë“±ë¡          | âŒ (êµ¬í˜• ì½”ë“œ í˜¸í™˜ìš©ë§Œ)        |
| sigaction() | ì•ˆì „í•˜ê³  ìœ ì—°í•œ ì‹œê·¸ë„ í•¸ë“¤ëŸ¬ ë“±ë¡ | âœ… (ì‹¤ì „ì—ì„œëŠ” sigaction ì‚¬ìš©) |

í•µì‹¬ íŒ¨í„´:

```
struct sigaction sa;
sa.sa_handler = handler_func; // ë˜ëŠ” sa_sigaction
sigemptyset(&sa.sa_mask);
sa.sa_flags = SA_RESTART;  // or SA_SIGINFO
sigaction(signum, &sa, NULL);
```

------

### ê²°ë¡ 

- ì‹œê·¸ë„ì€ **ë¦¬ëˆ…ìŠ¤/ìœ ë‹‰ìŠ¤ í”„ë¡œì„¸ìŠ¤ ì œì–´ì˜ ê¸°ë³¸ ìš”ì†Œ**ë‹¤.
- ì‹¤ì „ì—ì„œëŠ”:
  - `SIGCHLD` ì²˜ë¦¬ (fork() ì´í›„ ìì‹ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ ê°ì§€)
  - `SIGUSR1`, `SIGUSR2` ë¥¼ ì´ìš©í•œ í”„ë¡œì„¸ìŠ¤ ê°„ ì œì–´
  - `SIGTERM` ì²˜ë¦¬ â†’ graceful shutdown êµ¬í˜„
  - `SIGALRM` ìœ¼ë¡œ íƒ€ì´ë¨¸ ê¸°ëŠ¥ êµ¬í˜„
- **sigaction() ë¥¼ í‘œì¤€ìœ¼ë¡œ ì‚¬ìš©**í•˜ëŠ” ìŠµê´€ì„ ë°˜ë“œì‹œ ë“¤ì—¬ì•¼ í•œë‹¤ â†’ signal()ì€ ì˜ë„ì¹˜ ì•Šì€ í˜¸í™˜ì„± ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

## 9.2 ì‹œê·¸ë„ ë¸”ë¡œí‚¹ê³¼ ë§ˆìŠ¤í¬

#### ê°œìš”

**ì‹œê·¸ë„ ë¸”ë¡œí‚¹(signal blocking)** ì€:

- í”„ë¡œì„¸ìŠ¤ê°€ íŠ¹ì • ì‹œê·¸ë„ì„ **ì¼ì‹œì ìœ¼ë¡œ ìˆ˜ì‹ í•˜ì§€ ì•Šë„ë¡ ë§‰ëŠ” ê¸°ëŠ¥**ì´ë‹¤.
- â†’ ë¸”ë¡ëœ ë™ì•ˆ ì‹œê·¸ë„ì€ **pending ìƒíƒœë¡œ ìœ ì§€** â†’ ë¸”ë¡ì´ í•´ì œë˜ë©´ ì²˜ë¦¬ë¨.

#### ì£¼ìš” ì‚¬ìš© ì´ìœ 

- **Critical section ë³´í˜¸** (ì¤‘ê°„ì— ì‹œê·¸ë„ë¡œ ë°©í•´ë°›ìœ¼ë©´ ì•ˆ ë˜ëŠ” ì½”ë“œ êµ¬ê°„)
- **ì‹œê·¸ë„ ë™ê¸°í™” ì œì–´** (ì²˜ë¦¬ íƒ€ì´ë° ì§ì ‘ ì œì–´)
- **ì¼ë¶€ ì‹œê·¸ë„ ì§€ì—° ì²˜ë¦¬** (íŠ¹ì • êµ¬ê°„ì—ì„œë§Œ ì²˜ë¦¬ í—ˆìš©)

------

### 1ï¸âƒ£ ê´€ë ¨ API

| í•¨ìˆ˜               | ê¸°ëŠ¥                                                         |
| ------------------ | ------------------------------------------------------------ |
| sigprocmask()      | í˜„ì¬ í”„ë¡œì„¸ìŠ¤ì˜ ì‹œê·¸ë„ ë§ˆìŠ¤í¬ ë³€ê²½                           |
| pthread_sigmask()  | í˜„ì¬ ìŠ¤ë ˆë“œì˜ ì‹œê·¸ë„ ë§ˆìŠ¤í¬ ë³€ê²½ (ë©€í‹°ìŠ¤ë ˆë“œ ì•ˆì „)           |
| sigpending()       | í˜„ì¬ ë¸”ë¡ëœ ìƒíƒœì—ì„œ pending ëœ ì‹œê·¸ë„ í™•ì¸                  |
| sigset_t ê´€ë ¨ í•¨ìˆ˜ | ì‹œê·¸ë„ ì§‘í•© ì¡°ì‘ (sigemptyset, sigfillset, sigaddset, sigdelset) |

------

### 2ï¸âƒ£ ì‹œê·¸ë„ ì§‘í•©(sigset_t) ì¡°ì‘

#### ê¸°ë³¸ íŒ¨í„´

```
sigset_t set;

sigemptyset(&set);              // ì‹œê·¸ë„ ì§‘í•© ì´ˆê¸°í™” (ë¹ˆ ì§‘í•©)
sigaddset(&set, SIGINT);        // SIGINT ì¶”ê°€
sigaddset(&set, SIGTERM);       // SIGTERM ì¶”ê°€
sigdelset(&set, SIGTERM);       // SIGTERM ì œê±°
sigfillset(&set);               // ëª¨ë“  ì‹œê·¸ë„ ì¶”ê°€
```

â†’ **sigset_t** ëŠ” ì‹œê·¸ë„ ë²ˆí˜¸ë“¤ì˜ ì§‘í•©ì„ í‘œí˜„.

------

### 3ï¸âƒ£ sigprocmask()

#### ì›í˜•

```
int sigprocmask(int how, const sigset_t *set, sigset_t *oldset);
```

| ë§¤ê°œë³€ìˆ˜ | ì„¤ëª…                                |
| -------- | ----------------------------------- |
| how      | SIG_BLOCK, SIG_UNBLOCK, SIG_SETMASK |
| set      | ì ìš©í•  ì‹œê·¸ë„ ì§‘í•©                  |
| oldset   | ì´ì „ ì‹œê·¸ë„ ë§ˆìŠ¤í¬ ì €ì¥ (NULL ê°€ëŠ¥) |

#### ë™ì‘ ë°©ì‹

| how ê°’      | ë™ì‘                            |
| ----------- | ------------------------------- |
| SIG_BLOCK   | ì‹œê·¸ë„ ë¸”ë¡ ì¶”ê°€                |
| SIG_UNBLOCK | ì‹œê·¸ë„ ë¸”ë¡ í•´ì œ                |
| SIG_SETMASK | í˜„ì¬ ì‹œê·¸ë„ ë§ˆìŠ¤í¬ë¥¼ setë¡œ êµì²´ |

------

### 4ï¸âƒ£ ì˜ˆì œ 1ï¸âƒ£ ê¸°ë³¸ ë¸”ë¡œí‚¹/í•´ì œ

```
#include <stdio.h>
#include <signal.h>
#include <unistd.h>

void handler(int signum) {
    printf("Received signal %d\n", signum);
}

int main() {
    struct sigaction sa;
    sa.sa_handler = handler;
    sigemptyset(&sa.sa_mask);
    sa.sa_flags = 0;
    sigaction(SIGINT, &sa, NULL);

    sigset_t block_set;
    sigemptyset(&block_set);
    sigaddset(&block_set, SIGINT);

    printf("Blocking SIGINT for 5 seconds...\n");
    sigprocmask(SIG_BLOCK, &block_set, NULL);

    sleep(5);

    printf("Unblocking SIGINT now.\n");
    sigprocmask(SIG_UNBLOCK, &block_set, NULL);

    // Wait to observe if SIGINT is delivered now
    while (1) {
        sleep(1);
    }

    return 0;
}
```

#### ì‹¤í–‰ íë¦„

```
$ ./sigblock_example
Blocking SIGINT for 5 seconds...
# Ctrl+C ëˆŒëŸ¬ë„ ë°˜ì‘ ì—†ìŒ (SIGINT pending ìƒíƒœ)
Unblocking SIGINT now.
# ì¦‰ì‹œ "Received signal 2" ì¶œë ¥ë¨
```

â†’ SIGINTëŠ” pending ìƒíƒœì˜€ë‹¤ê°€ unblock ì‹œ ì²˜ë¦¬ë¨.

------

### 5ï¸âƒ£ sigpending()

#### ì›í˜•

```
int sigpending(sigset_t *set);
```

- í˜„ì¬ í”„ë¡œì„¸ìŠ¤ì— ëŒ€í•´ pending ìƒíƒœì¸ ì‹œê·¸ë„ ì§‘í•©ì„ ì¡°íšŒ.

#### ì˜ˆì œ 2ï¸âƒ£ pending ì‹œê·¸ë„ í™•ì¸

```
sigset_t pending_set;
sigpending(&pending_set);

if (sigismember(&pending_set, SIGINT)) {
    printf("SIGINT is pending\n");
}
```

â†’ SIGINTê°€ ë¸”ë¡ ìƒíƒœì—ì„œ ë°œìƒí•œ ê²½ìš° pending ìƒíƒœë¡œ ìœ ì§€ë¨ â†’ í™•ì¸ ê°€ëŠ¥.

------

### 6ï¸âƒ£ pthread_sigmask()

#### ì›í˜•

```
int pthread_sigmask(int how, const sigset_t *set, sigset_t *oldset);
```

- **ë©€í‹°ìŠ¤ë ˆë“œ í”„ë¡œì„¸ìŠ¤ì—ì„œ ìŠ¤ë ˆë“œë³„ ì‹œê·¸ë„ ë§ˆìŠ¤í¬ ì„¤ì • ê°€ëŠ¥**.
- â†’ ì“°ë ˆë“œë³„ë¡œ ì‹œê·¸ë„ ë¸”ë¡ ìƒíƒœë¥¼ ë³„ë„ë¡œ ì„¤ì •í•´ì•¼ í•˜ëŠ” ê²½ìš° ì‚¬ìš© (POSIX í‘œì¤€).

#### ì‹¤ì „ ì˜ˆ

- main threadë§Œ ì‹œê·¸ë„ ìˆ˜ì‹ í•˜ë„ë¡ ì„¤ì • â†’ worker threadì—ì„œëŠ” SIGINT ë¸”ë¡.

------

### 7ï¸âƒ£ ì •ë¦¬ íŒ¨í„´

#### ì‹œê·¸ë„ ë¸”ë¡œí‚¹ ê¸°ë³¸ íŒ¨í„´

```
sigset_t set;
sigemptyset(&set);
sigaddset(&set, SIGINT);
sigprocmask(SIG_BLOCK, &set, NULL);
```

#### ì‹œê·¸ë„ ë¸”ë¡œí‚¹ í•´ì œ

```
sigprocmask(SIG_UNBLOCK, &set, NULL);
```

#### ì‹œê·¸ë„ ë¸”ë¡œí‚¹ ì „ì²´ êµì²´

```
sigprocmask(SIG_SETMASK, &set, NULL);
```

------

### 8ï¸âƒ£ ì‹œê·¸ë„ ë¸”ë¡œí‚¹ì˜ ì‹¤ì „ í™œìš©

| ìš©ë„                   | í™œìš© ë°©ì‹                                                    |
| ---------------------- | ------------------------------------------------------------ |
| Critical section ë³´í˜¸  | ì‹œê·¸ë„ ë¸”ë¡ â†’ ì½”ë“œ ì‹¤í–‰ â†’ unblock                            |
| ì‹œê·¸ë„ ë™ê¸°ì  ì²˜ë¦¬     | íŠ¹ì • ì‹œì ì—ì„œë§Œ unblock                                      |
| ë©€í‹°ìŠ¤ë ˆë“œ ì‹œê·¸ë„ ì²˜ë¦¬ | main threadë§Œ ì‹œê·¸ë„ unblock ìƒíƒœ ìœ ì§€, ë‚˜ë¨¸ì§€ëŠ” block       |
| SIGCHLD í•¸ë“¤ëŸ¬ ì„¤ì¹˜ ì‹œ | ì„¤ì¹˜ ì „ SIGCHLD block â†’ handler ë“±ë¡ í›„ unblock (race condition ë°©ì§€) |

------

### 9ï¸âƒ£ ì •ë¦¬

| API                | ê¸°ëŠ¥                        | ë¹„ê³                      |
| ------------------ | --------------------------- | ------------------------ |
| sigprocmask()      | í”„ë¡œì„¸ìŠ¤ ì‹œê·¸ë„ ë§ˆìŠ¤í¬ ë³€ê²½ | ì¼ë°˜ í”„ë¡œì„¸ìŠ¤ìš©          |
| pthread_sigmask()  | ìŠ¤ë ˆë“œë³„ ì‹œê·¸ë„ ë§ˆìŠ¤í¬ ë³€ê²½ | ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ì‚¬ìš© |
| sigpending()       | pending ì‹œê·¸ë„ í™•ì¸         | debugging / sync ì œì–´ìš©  |
| sigset_t ê´€ë ¨ í•¨ìˆ˜ | ì‹œê·¸ë„ ì§‘í•© êµ¬ì„±/ë³€ê²½       | í•„ìˆ˜ ìœ í‹¸ í•¨ìˆ˜ë“¤         |

------

### ê²°ë¡ 

- **ì‹œê·¸ë„ ë¸”ë¡œí‚¹ê³¼ ë§ˆìŠ¤í¬ëŠ” ê³ ê¸‰ ì‹œê·¸ë„ ì²˜ë¦¬ì—ì„œ ë§¤ìš° ì¤‘ìš”í•œ ê¸°ìˆ **ì´ë‹¤.
- ì‹¤ì „ì—ì„œëŠ”:
  - **ì¤‘ìš” ì½”ë“œ êµ¬ê°„ ë³´í˜¸**
  - **race condition ë°©ì§€**
  - **ë©€í‹°ìŠ¤ë ˆë“œ ì‹œê·¸ë„ ì²˜ë¦¬ ì œì–´**
- â†’ ë°˜ë“œì‹œ `sigaction()` + `sigprocmask()` / `pthread_sigmask()` ë¥¼ í•¨ê»˜ ì“¸ ì¤„ ì•Œì•„ì•¼ ì•ˆì •ì ì¸ ì‹œê·¸ë„ ê¸°ë°˜ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.

## 9.3 `alarm()`, `pause()`, `kill()`

### ê°œìš”

ì´ ì„¸ ê°€ì§€ í•¨ìˆ˜ëŠ” **ì‹œê·¸ë„ ê¸°ë°˜ í”„ë¡œì„¸ìŠ¤ ì œì–´ì™€ ë™ê¸°í™”ì—ì„œ ìì£¼ ì‚¬ìš©í•˜ëŠ” ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜**ë‹¤.

| í•¨ìˆ˜      | ê¸°ëŠ¥                                       |
| --------- | ------------------------------------------ |
| `alarm()` | ì¼ì • ì‹œê°„ í›„ `SIGALRM` ì‹œê·¸ë„ ë°œìƒ ì˜ˆì•½    |
| `pause()` | ì‹œê·¸ë„ì„ ê¸°ë‹¤ë¦¬ë©° **í˜„ì¬ í”„ë¡œì„¸ìŠ¤ë¥¼ ë¸”ë¡** |
| `kill()`  | ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤(ë˜ëŠ” ìì‹ )ì—ê²Œ ì‹œê·¸ë„ ì „ì†¡   |

------

### 1ï¸âƒ£ `alarm()`

#### ì›í˜•

```
unsigned int alarm(unsigned int seconds);
```

#### ì„¤ëª…

- `seconds` í›„ì— ì»¤ë„ì´ **SIGALRM ì‹œê·¸ë„ì„ í˜„ì¬ í”„ë¡œì„¸ìŠ¤ì— ë³´ëƒ„**.
- `alarm(0)` í˜¸ì¶œ ì‹œ **ì˜ˆì•½ëœ ì•ŒëŒ ì·¨ì†Œ**.
- ë°˜í™˜ê°’: **ê¸°ì¡´ ì˜ˆì•½ì´ ë‚¨ì•„ìˆë˜ ì´ˆ ìˆ˜** (ì—†ìœ¼ë©´ 0).

#### ì‚¬ìš© ì˜ˆ

```
#include <stdio.h>
#include <signal.h>
#include <unistd.h>

void alarm_handler(int signum) {
    printf("Alarm triggered! Received signal %d\n", signum);
}

int main() {
    signal(SIGALRM, alarm_handler);

    printf("Setting alarm for 3 seconds...\n");
    alarm(3);

    while (1) {
        pause();  // ì‹œê·¸ë„ì´ ì˜¬ ë•Œê¹Œì§€ ëŒ€ê¸°
    }

    return 0;
}
```

â†’ ì‹¤í–‰ ê²°ê³¼:

```
Setting alarm for 3 seconds...
Alarm triggered! Received signal 14
```

â†’ **SIGALRM = ì‹œê·¸ë„ ë²ˆí˜¸ 14**.

------

### 2ï¸âƒ£ `pause()`

#### ì›í˜•

```
int pause(void);
```

#### ì„¤ëª…

- í”„ë¡œì„¸ìŠ¤ë¥¼ **ì‹œê·¸ë„ì´ ìˆ˜ì‹ ë  ë•Œê¹Œì§€ ë¸”ë¡**.
- ì‹œê·¸ë„ í•¸ë“¤ëŸ¬ ì‹¤í–‰ í›„ `pause()`ê°€ ë°˜í™˜ë¨ â†’ í•­ìƒ -1 ë°˜í™˜, `errno`ì— `EINTR` ì„¤ì •ë¨.

#### ì‚¬ìš© ì˜ˆ

- ì¼ë°˜ì ìœ¼ë¡œ **ì‹œê·¸ë„ë§Œ ê¸°ë‹¤ë¦¬ëŠ” ë©”ì¸ ë£¨í”„**ì— ì‚¬ìš©:

```
while (1) {
    pause();
}
```

â†’ ì£¼ì˜: ë°˜ë“œì‹œ **ì‹œê·¸ë„ í•¸ë“¤ëŸ¬ ë“±ë¡ í›„ ì‚¬ìš©**.

------

### 3ï¸âƒ£ `kill()`

#### ì›í˜•

```
#include <signal.h>

int kill(pid_t pid, int sig);
```

#### ì„¤ëª…

- `pid` í”„ë¡œì„¸ìŠ¤ì— `sig` ì‹œê·¸ë„ì„ ì „ì†¡.

| pid ê°’ | ì˜ë¯¸                                    |
| ------ | --------------------------------------- |
| > 0    | í•´ë‹¹ pidì˜ í”„ë¡œì„¸ìŠ¤ì— ì‹œê·¸ë„ ì „ì†¡       |
| 0      | í˜„ì¬ í”„ë¡œì„¸ìŠ¤ ê·¸ë£¹ ì „ì²´ì— ì‹œê·¸ë„ ì „ì†¡   |
| -1     | ê¶Œí•œ ìˆëŠ” ëª¨ë“  í”„ë¡œì„¸ìŠ¤ì— ì‹œê·¸ë„ ì „ì†¡   |
| < -1   | íŠ¹ì • í”„ë¡œì„¸ìŠ¤ ê·¸ë£¹(-pgid)ì— ì‹œê·¸ë„ ì „ì†¡ |

#### ì£¼ì˜

- **kill()ëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ "ì£½ì¸ë‹¤"ëŠ” ëœ»ì´ ì•„ë‹˜** â†’ ì‹œê·¸ë„ì„ "ë³´ë‚¸ë‹¤"ëŠ” ì˜ë¯¸ì„.
- ì‹¤ì œ ì¢…ë£Œ ì—¬ë¶€ëŠ” ì‹œê·¸ë„ í•¸ë“¤ë§ì— ë”°ë¼ ë‹¬ë¼ì§.
- â†’ SIGKILL(9) ì „ì†¡ ì‹œ ë¬´ì¡°ê±´ ì¢…ë£Œ.

------

#### ì˜ˆì œ 1ï¸âƒ£ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ì— SIGUSR1 ë³´ë‚´ê¸°

```
$ kill -SIGUSR1 <PID>
```

â†’ C ì½”ë“œë¡œëŠ”:

```
kill(target_pid, SIGUSR1);
```

------

#### ì˜ˆì œ 2ï¸âƒ£ ìì‹ ì—ê²Œ ì‹œê·¸ë„ ë³´ë‚´ê¸°

```
kill(getpid(), SIGUSR1);
```

â†’ í˜„ì¬ í”„ë¡œì„¸ìŠ¤ì— ì‹œê·¸ë„ ì „ì†¡ â†’ í•¸ë“¤ëŸ¬ê°€ ì‹¤í–‰ë¨.

------

### 4ï¸âƒ£ ì‹¤ì „ ì˜ˆì œ: `alarm()` + `pause()` ì¡°í•©

```
#include <stdio.h>
#include <signal.h>
#include <unistd.h>

void alarm_handler(int signum) {
    printf("Alarm fired! SIGALRM received.\n");
}

int main() {
    signal(SIGALRM, alarm_handler);

    printf("Setting alarm for 5 seconds...\n");
    alarm(5);

    printf("Waiting for alarm...\n");
    pause();  // SIGALRM ì˜¬ ë•Œê¹Œì§€ ëŒ€ê¸°

    printf("Alarm was handled, program will exit.\n");

    return 0;
}
```

#### ì‹¤í–‰ íë¦„

```
Setting alarm for 5 seconds...
Waiting for alarm...
(5ì´ˆ í›„)
Alarm fired! SIGALRM received.
Alarm was handled, program will exit.
```

â†’ ë§¤ìš° ë§ì´ ì“°ì´ëŠ” **íƒ€ì´ë¨¸ ê¸°ë°˜ êµ¬ì¡°ì˜ ê¸°ë³¸ íŒ¨í„´**.

------

### 5ï¸âƒ£ ì‹¤ì „ í™œìš©

| í•¨ìˆ˜    | ì£¼ìš” í™œìš© ì‚¬ë¡€                                               |
| ------- | ------------------------------------------------------------ |
| alarm() | íƒ€ì„ì•„ì›ƒ êµ¬í˜„, í”„ë¡œì„¸ìŠ¤ watchdog íƒ€ì´ë¨¸                      |
| pause() | ì´ë²¤íŠ¸ ê¸°ë°˜ ë©”ì¸ ë£¨í”„ êµ¬ì„±                                   |
| kill()  | í”„ë¡œì„¸ìŠ¤ ê°„ ì œì–´ (start/stop/reload ë“±) êµ¬í˜„, SIGUSR1/2 í™œìš© |

------

### 6ï¸âƒ£ ê³ ê¸‰ í™œìš© íŒ¨í„´

#### alarm()ìœ¼ë¡œ íƒ€ì„ì•„ì›ƒ êµ¬í˜„ ì˜ˆì œ

```
alarm(10);  // 10ì´ˆ í›„ timeout ì²˜ë¦¬ ì˜ˆì •

ssize_t n = read(fd, buf, size);  // readê°€ ë¸”ë¡ë¨

// readê°€ 10ì´ˆ ë‚´ì— ëë‚˜ì§€ ì•Šìœ¼ë©´ SIGALRM ë°œìƒ â†’ interrupted system call
```

#### kill()ìœ¼ë¡œ ìì‹ í”„ë¡œì„¸ìŠ¤ ì œì–´

```
pid_t child_pid = fork();

if (child_pid == 0) {
    // child
    while (1) {
        pause();
    }
} else {
    sleep(2);
    kill(child_pid, SIGTERM);  // ìì‹ ì¢…ë£Œ ìš”ì²­
    wait(NULL);
}
```

------

### 7ï¸âƒ£ ì •ë¦¬

| API     | ê¸°ëŠ¥                 | ì£¼ìš” íŠ¹ì§•                           |
| ------- | -------------------- | ----------------------------------- |
| alarm() | nì´ˆ í›„ SIGALRM ì˜ˆì•½  | ê°„ë‹¨í•œ íƒ€ì´ë¨¸ êµ¬í˜„ì— ìœ ìš©           |
| pause() | ì‹œê·¸ë„ ìˆ˜ì‹ ê¹Œì§€ ë¸”ë¡ | ì‹œê·¸ë„ ê¸°ë°˜ ë©”ì¸ ë£¨í”„ì—ì„œ ìœ ìš©      |
| kill()  | ì‹œê·¸ë„ ì „ì†¡          | í”„ë¡œì„¸ìŠ¤ ì œì–´, IPC ëŒ€ì²´ë¡œ ìì£¼ ì‚¬ìš© |

------

### ê²°ë¡ 

- `alarm()` + `pause()` + `kill()` ëŠ” ì‹œê·¸ë„ ê¸°ë°˜ í”„ë¡œì„¸ìŠ¤ ì œì–´ì˜ **ê¸°ë³¸ ë„êµ¬**ë‹¤.
- ì‹¤ì „ì—ì„œëŠ”:
  - **íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬**
  - **ì´ë²¤íŠ¸ ê¸°ë°˜ ë£¨í”„ êµ¬ì„±**
  - **í”„ë¡œì„¸ìŠ¤ ê°„ ì œì–´ / IPC ëŒ€ì²´**
     ë“±ì— ë§¤ìš° ë§ì´ ì‚¬ìš©ëœë‹¤.
- â†’ ë°˜ë“œì‹œ **sigaction()** + `alarm()` + `pause()` ì¡°í•©ìœ¼ë¡œ ì•ˆì •ì  íŒ¨í„´ êµ¬ì„±í•˜ëŠ” ìŠµê´€ì„ ë“¤ì´ëŠ” ê²ƒì´ ì¢‹ë‹¤.

## 9.4 ì»¤ìŠ¤í…€ ì‹œê·¸ë„ í•¸ë“¤ëŸ¬ ì‘ì„±

### ê°œìš”

**ì»¤ìŠ¤í…€ ì‹œê·¸ë„ í•¸ë“¤ëŸ¬**ëŠ” íŠ¹ì • ì‹œê·¸ë„ì„ ìˆ˜ì‹ í–ˆì„ ë•Œ **í”„ë¡œê·¸ë¨ì´ ì›í•˜ëŠ” ë™ì‘ì„ ì§ì ‘ êµ¬í˜„**í•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤.

í™œìš© ì˜ˆ:

- **SIGINT (Ctrl+C) ë¬´ì‹œ ë˜ëŠ” graceful shutdown ì²˜ë¦¬**
- **SIGUSR1 / SIGUSR2 ë¡œ ìœ ì € ì •ì˜ ì´ë²¤íŠ¸ ì²˜ë¦¬**
- **SIGTERM ìœ¼ë¡œ ì„œë²„ ì¢…ë£Œ ì‹œ ë¦¬ì†ŒìŠ¤ ì •ë¦¬**
- **SIGCHLD ë¡œ ìì‹ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ ê°ì§€**

í•¸ë“¤ëŸ¬ëŠ” ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì¡°ë¡œ ì‘ì„±í•œë‹¤:

```
void handler(int signum);
```

or (ê³ ê¸‰):

```
void handler(int signum, siginfo_t *info, void *context);
```

------

### 1ï¸âƒ£ sigaction ê¸°ë°˜ ì»¤ìŠ¤í…€ í•¸ë“¤ëŸ¬ ì‘ì„±

#### ê¸°ë³¸ íŒ¨í„´

```
struct sigaction sa;
sa.sa_handler = my_handler;  // ë˜ëŠ” sa_sigaction ì‚¬ìš©
sigemptyset(&sa.sa_mask);    // í•¸ë“¤ëŸ¬ ì‹¤í–‰ ì¤‘ ë¸”ë¡í•  ì‹œê·¸ë„ ì§‘í•© (ì—†ìœ¼ë©´ ë¹„ì›€)
sa.sa_flags = SA_RESTART;    // ì‹œìŠ¤í…œ ì½œ ìë™ ì¬ì‹œë„

sigaction(SIGINT, &sa, NULL);
```

#### í•¸ë“¤ëŸ¬ í•¨ìˆ˜ ì˜ˆ

```
void my_handler(int signum) {
    printf("Received signal %d\n", signum);
}
```

------

### 2ï¸âƒ£ ê³ ê¸‰ í•¸ë“¤ëŸ¬ (siginfo_t ì‚¬ìš©)

#### íŒ¨í„´

```
struct sigaction sa;
sa.sa_sigaction = my_handler;
sigemptyset(&sa.sa_mask);
sa.sa_flags = SA_SIGINFO;

sigaction(SIGUSR1, &sa, NULL);
```

#### í•¸ë“¤ëŸ¬ í•¨ìˆ˜ ì˜ˆ

```
void my_handler(int signum, siginfo_t *info, void *context) {
    printf("Received signal %d from PID %d\n", signum, info->si_pid);
}
```

â†’ ê³ ê¸‰ í•¸ë“¤ëŸ¬ëŠ” ë‹¤ìŒ ì •ë³´ë¥¼ ë°›ì„ ìˆ˜ ìˆìŒ:

| ì •ë³´           | ì„¤ëª…                         |
| -------------- | ---------------------------- |
| signum         | ì‹œê·¸ë„ ë²ˆí˜¸                  |
| info->si_pid   | ì‹œê·¸ë„ì„ ë³´ë‚¸ í”„ë¡œì„¸ìŠ¤ì˜ PID |
| info->si_uid   | ì‹œê·¸ë„ì„ ë³´ë‚¸ í”„ë¡œì„¸ìŠ¤ì˜ UID |
| ê¸°íƒ€ info í•„ë“œ | ì‹œê·¸ë„ íƒ€ì…ë³„ ì¶”ê°€ ì •ë³´      |

------

### 3ï¸âƒ£ ì‹¤ì „ ì˜ˆì œ 1ï¸âƒ£ SIGINT graceful shutdown

```
#include <stdio.h>
#include <signal.h>
#include <unistd.h>
#include <stdlib.h>

volatile sig_atomic_t stop = 0;

void sigint_handler(int signum) {
    printf("SIGINT received, preparing to exit...\n");
    stop = 1;
}

int main() {
    struct sigaction sa;
    sa.sa_handler = sigint_handler;
    sigemptyset(&sa.sa_mask);
    sa.sa_flags = SA_RESTART;
    sigaction(SIGINT, &sa, NULL);

    while (!stop) {
        printf("Working...\n");
        sleep(1);
    }

    printf("Cleanup complete, exiting.\n");

    return 0;
}
```

#### íë¦„

- Ctrl+C ì…ë ¥ ì‹œ **SIGINT** â†’ stop flag ì„¤ì • â†’ loop ì¢…ë£Œ â†’ cleanup í›„ ì •ìƒ ì¢…ë£Œ.

------

### 4ï¸âƒ£ ì‹¤ì „ ì˜ˆì œ 2ï¸âƒ£ SIGUSR1 ê³ ê¸‰ í•¸ë“¤ëŸ¬

```
#include <stdio.h>
#include <signal.h>
#include <unistd.h>

void sigusr1_handler(int signum, siginfo_t *info, void *context) {
    printf("SIGUSR1 received from PID %d, UID %d\n", info->si_pid, info->si_uid);
}

int main() {
    struct sigaction sa;
    sa.sa_sigaction = sigusr1_handler;
    sigemptyset(&sa.sa_mask);
    sa.sa_flags = SA_SIGINFO;
    sigaction(SIGUSR1, &sa, NULL);

    while (1) {
        printf("Waiting for SIGUSR1...\n");
        sleep(5);
    }

    return 0;
}
```

#### ì‚¬ìš©ë²•

```
$ ./sigusr1_handler
# ë‹¤ë¥¸ í„°ë¯¸ë„ì—ì„œ:
$ kill -SIGUSR1 <PID>
```

ì¶œë ¥ ì˜ˆ:

```
SIGUSR1 received from PID 12345, UID 1000
```

------

### 5ï¸âƒ£ ì»¤ìŠ¤í…€ ì‹œê·¸ë„ í•¸ë“¤ëŸ¬ ì‘ì„± ì‹œ ì£¼ì˜ì‚¬í•­

#### ì¬ì§„ì… ì•ˆì „ì„± (reentrancy)

- ì‹œê·¸ë„ í•¸ë“¤ëŸ¬ ë‚´ì—ì„œëŠ” **ë¹„ë™ê¸° ì•ˆì „ í•¨ìˆ˜ë§Œ ì‚¬ìš©í•´ì•¼ í•¨**.
- ì˜ˆë¥¼ ë“¤ì–´ `printf()`ëŠ” technically ë¹„ë™ê¸° ì•ˆì „ì´ ì•„ë‹˜ â†’ ì‹¤ì „ì—ì„œëŠ” `write()` ì‚¬ìš© ê¶Œì¥.

```
const char msg[] = "SIGINT received\n";
write(STDOUT_FILENO, msg, sizeof(msg) - 1);
```

#### í—ˆìš©ë˜ëŠ” ì•ˆì „ í•¨ìˆ˜ ëª©ë¡:

â†’ man 7 signal â†’ "Async-signal-safe functions" ì„¹ì…˜ ì°¸ì¡°.

#### ê¸€ë¡œë²Œ ìƒíƒœ ì‚¬ìš©

- í•¸ë“¤ëŸ¬ ë‚´ì—ì„œëŠ” **volatile sig_atomic_t ë³€ìˆ˜ ì‚¬ìš© ê¶Œì¥**.

```
volatile sig_atomic_t stop = 0;
```

- ë©€í‹°ìŠ¤ë ˆë“œ í”„ë¡œê·¸ë¨ì—ì„œëŠ” ì£¼ì˜ â†’ ì‹œê·¸ë„ê³¼ ìŠ¤ë ˆë“œ ë™ê¸°í™”ê°€ ë§¤ìš° ì¤‘ìš”í•´ì§ â†’ `pthread_sigmask()` ì‚¬ìš© ë³‘í–‰ ì¶”ì²œ.

------

### 6ï¸âƒ£ ì»¤ìŠ¤í…€ í•¸ë“¤ëŸ¬ ì£¼ìš” í™œìš© ì˜ˆì‹œ

| ì‹œê·¸ë„            | ì»¤ìŠ¤í…€ í•¸ë“¤ëŸ¬ í™œìš© ì‚¬ë¡€                             |
| ----------------- | --------------------------------------------------- |
| SIGINT            | Ctrl+C ì‹œ graceful shutdown êµ¬í˜„                    |
| SIGTERM           | í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ ì‹œ ë¦¬ì†ŒìŠ¤ ì •ë¦¬ (ì„œë²„, daemon ë“±)      |
| SIGCHLD           | ìì‹ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ ê°ì§€ í›„ wait() í˜¸ì¶œ              |
| SIGUSR1 / SIGUSR2 | í”„ë¡œì„¸ìŠ¤ ê°„ ì‚¬ìš©ì ì •ì˜ ì´ë²¤íŠ¸ ì²˜ë¦¬ (IPC ëŒ€ì²´ íŒ¨í„´) |
| SIGALRM           | íƒ€ì´ë¨¸ ê¸°ë°˜ ì²˜ë¦¬                                    |

------

### 7ï¸âƒ£ ì •ë¦¬

| ì‹œê·¸ë„ ì²˜ë¦¬ ë°©ë²•        | ê¶Œì¥ ì‚¬ìš©                  |
| ----------------------- | -------------------------- |
| signal()                | âŒ (í˜¸í™˜ì„±ìš©)               |
| sigaction(sa_handler)   | ê¸°ë³¸ í•¸ë“¤ë§ ì‹œ ì‚¬ìš©        |
| sigaction(sa_sigaction) | ê³ ê¸‰ í•¸ë“¤ë§ ì‹œ ì‚¬ìš© (ì¶”ì²œ) |

í•¸ë“¤ëŸ¬ ì‘ì„± ì‹œ ì£¼ì˜:

- **ë¹„ë™ê¸° ì•ˆì „ í•¨ìˆ˜ë§Œ ì‚¬ìš©**.
- **Global flag** ë¡œ ë™ì‘ ì „ë‹¬.
- ë©€í‹°ìŠ¤ë ˆë“œì—ì„œëŠ” `pthread_sigmask()` ì‚¬ìš© ê³ ë ¤.

------

### ê²°ë¡ 

- ì»¤ìŠ¤í…€ ì‹œê·¸ë„ í•¸ë“¤ëŸ¬ëŠ” **ë¦¬ëˆ…ìŠ¤ ì‹œìŠ¤í…œ í”„ë¡œê·¸ë˜ë°ì˜ í•„ìˆ˜ íŒ¨í„´**ì´ë‹¤.
- ì‹¤ì „ì—ì„œëŠ” ë°˜ë“œì‹œ **sigaction() + ê³ ê¸‰ í•¸ë“¤ëŸ¬(sa_sigaction)** ì‚¬ìš©ë²•ê¹Œì§€ ìˆ™ì§€í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
- í•¸ë“¤ëŸ¬ ì‘ì„± ì‹œ ë°˜ë“œì‹œ:
  - ë¹„ë™ê¸° ì•ˆì „ í•¨ìˆ˜ ì‚¬ìš©
  - ê¸€ë¡œë²Œ flag ê¸°ë°˜ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ êµ¬í˜„
  - ì‹œê·¸ë„ ë¸”ë¡œí‚¹ ë§ˆìŠ¤í¬ ì ì ˆíˆ ì„¤ì • â†’ **race condition ë°©ì§€**.

## 9.5 ì‹œê·¸ë„ì„ í†µí•œ ìƒíƒœ ì „ì´ êµ¬í˜„

### ê°œìš”

**ìƒíƒœ ì „ì´(State transition)** ë€:

- ì‹œìŠ¤í…œì´ ì—¬ëŸ¬ ìƒíƒœ ì¤‘ í•˜ë‚˜ì— ìˆìœ¼ë©°,
- **ì´ë²¤íŠ¸(ì—¬ê¸°ì„œëŠ” ì‹œê·¸ë„)ê°€ ë°œìƒí•˜ë©´ ë‹¤ë¥¸ ìƒíƒœë¡œ ì „ì´**í•˜ëŠ” ëª¨ë¸ì„ ë§í•œë‹¤.

**ì‹œê·¸ë„ ê¸°ë°˜ ìƒíƒœ ì „ì´**ëŠ”:

- ì‹œê·¸ë„ì„ í†µí•´ í”„ë¡œì„¸ìŠ¤ ì™¸ë¶€ì—ì„œ **í˜„ì¬ ìƒíƒœë¥¼ ë³€ê²½í•˜ê±°ë‚˜ ë™ì‘ì„ ì œì–´**í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.

â†’ ì´ë²¤íŠ¸ ê¸°ë°˜ ì„œë²„, Daemon, Interactive process, Simulation ë“±ì— ë§ì´ ì‚¬ìš©ë¨.

------

### 1ï¸âƒ£ ê¸°ë³¸ êµ¬ì„±

#### ìƒíƒœ ë¨¸ì‹  ì„¤ê³„

```
enum state {
    STATE_IDLE,
    STATE_RUNNING,
    STATE_PAUSED,
    STATE_TERMINATING
};
```

â†’ ê¸€ë¡œë²Œ ìƒíƒœ ë³€ìˆ˜ë¡œ í˜„ì¬ ìƒíƒœ ì €ì¥:

```
volatile sig_atomic_t current_state = STATE_IDLE;
```

â†’ ê° ì‹œê·¸ë„ â†’ íŠ¹ì • ìƒíƒœë¡œ ì „ì´:

| ì‹œê·¸ë„  | ìƒíƒœ ì „ì´                         |
| ------- | --------------------------------- |
| SIGUSR1 | IDLE â†’ RUNNING                    |
| SIGUSR2 | RUNNING â†’ PAUSED â†’ RUNNING (í† ê¸€) |
| SIGTERM | ëª¨ë“  ìƒíƒœ â†’ TERMINATING           |

â†’ ì´ì™€ ê°™ì€ ë§¤í•‘ìœ¼ë¡œ ì»¤ìŠ¤í…€ í•¸ë“¤ëŸ¬ ì‘ì„±.

------

### 2ï¸âƒ£ ì‹œê·¸ë„ í•¸ë“¤ëŸ¬ ì‘ì„±

í•¸ë“¤ëŸ¬ ë‚´ë¶€ì—ì„œ:

- **ì „ì—­ ìƒíƒœ ë³€ìˆ˜ ë³€ê²½**ë§Œ ìˆ˜í–‰ (ì£¼ì˜: ë¹„ë™ê¸° ì•ˆì „ì„± ë³´ì¥ í•„ìš”).
- ë³µì¡í•œ ë¡œì§ì€ ë©”ì¸ ë£¨í”„ì—ì„œ ìƒíƒœì— ë”°ë¼ ìˆ˜í–‰.

------

### 3ï¸âƒ£ ì‹¤ì „ ì˜ˆì œ: ìƒíƒœ ì „ì´ êµ¬í˜„

```
#include <stdio.h>
#include <signal.h>
#include <unistd.h>

enum state {
    STATE_IDLE,
    STATE_RUNNING,
    STATE_PAUSED,
    STATE_TERMINATING
};

volatile sig_atomic_t current_state = STATE_IDLE;

void signal_handler(int signum) {
    switch (signum) {
        case SIGUSR1:
            current_state = STATE_RUNNING;
            break;
        case SIGUSR2:
            if (current_state == STATE_RUNNING)
                current_state = STATE_PAUSED;
            else if (current_state == STATE_PAUSED)
                current_state = STATE_RUNNING;
            break;
        case SIGTERM:
            current_state = STATE_TERMINATING;
            break;
        default:
            break;
    }
}

void print_state() {
    switch (current_state) {
        case STATE_IDLE:
            printf("[STATE] IDLE\n");
            break;
        case STATE_RUNNING:
            printf("[STATE] RUNNING\n");
            break;
        case STATE_PAUSED:
            printf("[STATE] PAUSED\n");
            break;
        case STATE_TERMINATING:
            printf("[STATE] TERMINATING\n");
            break;
    }
}

int main() {
    struct sigaction sa;
    sa.sa_handler = signal_handler;
    sigemptyset(&sa.sa_mask);
    sa.sa_flags = SA_RESTART;

    sigaction(SIGUSR1, &sa, NULL);
    sigaction(SIGUSR2, &sa, NULL);
    sigaction(SIGTERM, &sa, NULL);

    printf("PID: %d\n", getpid());
    printf("Send SIGUSR1 to start, SIGUSR2 to pause/resume, SIGTERM to terminate.\n");

    while (current_state != STATE_TERMINATING) {
        print_state();

        if (current_state == STATE_RUNNING) {
            // Simulated work
            printf("Doing work...\n");
            sleep(1);
        } else {
            sleep(1);
        }
    }

    printf("Exiting gracefully.\n");

    return 0;
}
```

------

### 4ï¸âƒ£ ì‚¬ìš©ë²•

```
$ ./state_machine
PID: 12345
Send SIGUSR1 to start, SIGUSR2 to pause/resume, SIGTERM to terminate.
```

â†’ ë‹¤ë¥¸ í„°ë¯¸ë„ì—ì„œ:

```
$ kill -SIGUSR1 12345
$ kill -SIGUSR2 12345
$ kill -SIGTERM 12345
```

#### íë¦„ ì˜ˆì‹œ ì¶œë ¥:

```
[STATE] IDLE
[STATE] IDLE
[STATE] RUNNING
Doing work...
Doing work...
[STATE] PAUSED
[STATE] PAUSED
[STATE] RUNNING
Doing work...
Doing work...
[STATE] TERMINATING
Exiting gracefully.
```

------

### 5ï¸âƒ£ ê³ ê¸‰ í™œìš© íŒ¨í„´

#### ê³ ê¸‰ ìƒíƒœ ë¨¸ì‹  ì„¤ê³„

| ìƒíƒœ        | í—ˆìš© ì‹œê·¸ë„      | ì „ì´ ê°€ëŠ¥ ìƒíƒœ       |
| ----------- | ---------------- | -------------------- |
| IDLE        | SIGUSR1          | RUNNING              |
| RUNNING     | SIGUSR2, SIGTERM | PAUSED, TERMINATING  |
| PAUSED      | SIGUSR2, SIGTERM | RUNNING, TERMINATING |
| TERMINATING | N/A              | -                    |

#### êµ¬í˜„ ì‹œ ì£¼ì˜ì‚¬í•­

- **í•¸ë“¤ëŸ¬ ë‚´ì—ì„œëŠ” ë°˜ë“œì‹œ ë‹¨ìˆœí•œ ìƒíƒœ ì „ì´ë§Œ êµ¬í˜„**.
- ìƒíƒœ ì „ì´ í›„ ì‹¤ì œ ë™ì‘(íŒŒì¼ I/O, ë™ì  ë©”ëª¨ë¦¬ ë“±)ì€ ë©”ì¸ ë£¨í”„ì—ì„œ ì²˜ë¦¬.
- ë³µì¡í•œ ìƒíƒœ ë¨¸ì‹ ì¼ ê²½ìš° â†’ `switch-case` + transition table ì‚¬ìš© ê¶Œì¥.

------

### 6ï¸âƒ£ ì •ë¦¬

| ê¸°ìˆ  ìš”ì†Œ                            | ì—­í•                           |
| ------------------------------------ | ----------------------------- |
| sigaction() + ì»¤ìŠ¤í…€ í•¸ë“¤ëŸ¬          | ì‹œê·¸ë„ ìˆ˜ì‹  ì‹œ ìƒíƒœ ì „ì´ êµ¬í˜„ |
| volatile sig_atomic_t ì „ì—­ ìƒíƒœ ë³€ìˆ˜ | í˜„ì¬ ìƒíƒœ í‘œí˜„                |
| ë©”ì¸ ë£¨í”„                            | ìƒíƒœ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘ ìˆ˜í–‰       |
| ì‹œê·¸ë„ â†’ ìƒíƒœ ë§¤í•‘ í‘œ                | ëª…í™•í•˜ê²Œ ì„¤ê³„ í•„ìš”            |

------

### ê²°ë¡ 

- **ì‹œê·¸ë„ ê¸°ë°˜ ìƒíƒœ ì „ì´ êµ¬í˜„ì€ ì´ë²¤íŠ¸ ê¸°ë°˜ í”„ë¡œì„¸ìŠ¤ ì„¤ê³„ì˜ í•µì‹¬ íŒ¨í„´**ì´ë‹¤.
- ì‹¤ì „ì—ì„œëŠ”:
  - **ì„œë²„ graceful reload/stop**
  - **ë°ëª¬ í”„ë¡œì„¸ìŠ¤ ìƒíƒœ ë³€ê²½**
  - **ë‹¨ìˆœ IPC ëŒ€ì²´** (ì‹œê·¸ë„ë¡œ ìƒíƒœ ì „í™˜)
- ë°˜ë“œì‹œ:
  - sigaction() + ê¸€ë¡œë²Œ ìƒíƒœ ì„¤ê³„
  - í•¸ë“¤ëŸ¬ ë‚´ ë™ì‘ ìµœì†Œí™”
  - ë©”ì¸ ë£¨í”„ì™€ ìƒíƒœ ê¸°ë°˜ ë…¼ë¦¬ ë¶„ë¦¬
     â†’ ì´ ì›ì¹™ì„ ì§€í‚¤ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.

# ğŸ“ ì‹¤ìŠµ

## Ctrl+C ë¬´ì‹œ, ë¡œê·¸ ì €ì¥ ì¢…ë£Œ ì‹œë®¬ë ˆì´í„°

ì´ ì˜ˆì œëŠ” **SIGINT ë¬´ì‹œ**, **SIGTERM ìˆ˜ì‹  ì‹œ ë¡œê·¸ ì €ì¥ ë° ì •ìƒ ì¢…ë£Œ**ë¥¼ ëª©í‘œë¡œ í•œë‹¤.

------

### âœ… ìš”êµ¬ì‚¬í•­

| í•­ëª©                   | ì„¤ëª…                                             |
| ---------------------- | ------------------------------------------------ |
| âœ… SIGINT (Ctrl+C)      | ë¬´ì‹œ                                             |
| âœ… SIGTERM              | ë¡œê·¸ íŒŒì¼ì— ë©”ì‹œì§€ ê¸°ë¡ í›„ ì¢…ë£Œ                  |
| âœ… ë¡œê·¸ íŒŒì¼            | `shutdown.log` ì— ì €ì¥                           |
| âœ… ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ ê³ ë ¤ | ë¡œê·¸ ì €ì¥ì„ ëˆˆì— ë³´ì´ê²Œ ì¶œë ¥ (tail ë“± í™œìš© ê°€ëŠ¥) |

------

### ğŸ“„ ì „ì²´ ì½”ë“œ ì˜ˆì œ

```
#include <stdio.h>
#include <stdlib.h>
#include <signal.h>
#include <unistd.h>
#include <time.h>
#include <string.h>

#define LOGFILE "shutdown.log"

void sigint_handler(int signum) {
    // Ctrl+C ë¬´ì‹œ
    printf("SIGINT (Ctrl+C) ignored.\n");
}

void sigterm_handler(int signum) {
    FILE *log = fopen(LOGFILE, "a");
    if (log == NULL) {
        perror("fopen");
        exit(EXIT_FAILURE);
    }

    // í˜„ì¬ ì‹œê° ì €ì¥
    time_t now = time(NULL);
    char *timestamp = ctime(&now); // ìë™ ê°œí–‰ í¬í•¨
    if (timestamp == NULL) {
        timestamp = "UNKNOWN TIME\n";
    }

    fprintf(log, "[TERMINATED] Received SIGTERM at %s", timestamp);
    fclose(log);

    printf("SIGTERM received, shutting down gracefully.\n");
    exit(0);
}

int main() {
    // SIGINT ë¬´ì‹œ
    struct sigaction sa_int;
    sa_int.sa_handler = sigint_handler;
    sigemptyset(&sa_int.sa_mask);
    sa_int.sa_flags = SA_RESTART;
    sigaction(SIGINT, &sa_int, NULL);

    // SIGTERM ì²˜ë¦¬
    struct sigaction sa_term;
    sa_term.sa_handler = sigterm_handler;
    sigemptyset(&sa_term.sa_mask);
    sa_term.sa_flags = SA_RESTART;
    sigaction(SIGTERM, &sa_term, NULL);

    printf("PID: %d\n", getpid());
    printf("Running... Try Ctrl+C or `kill -TERM %d`\n", getpid());

    // ë¬´í•œ ë£¨í”„
    while (1) {
        printf("Still alive...\n");
        sleep(2);
    }

    return 0;
}
```

------

### ğŸ§ª ì‹¤ìŠµ ë°©ë²•

**1. ì»´íŒŒì¼**

```
gcc -o ignore_sigint_logger ignore_sigint_logger.c
```

**2. ì‹¤í–‰**

```
./ignore_sigint_logger
```

**3. Ctrl+C ì…ë ¥**

```
^C
SIGINT (Ctrl+C) ignored.
```

**4. SIGTERM ë³´ë‚´ê¸° (ë‹¤ë¥¸ í„°ë¯¸ë„ì—ì„œ)**

```
kill -TERM <PID>
```

**5. ë¡œê·¸ í™•ì¸**

```
cat shutdown.log
```

```
[TERMINATED] Received SIGTERM at Mon Jun 10 01:24:13 2025
```

------

### ğŸ›  ê³ ê¸‰ í™•ì¥ ì•„ì´ë””ì–´

| ê¸°ëŠ¥                            | ì„¤ëª…                                |
| ------------------------------- | ----------------------------------- |
| `SIGQUIT` ì‹œ ê°•ì œ ì¢…ë£Œ          | Ctrl+\ ëˆŒë €ì„ ë•Œë§Œ ê°•ì œ ì¢…ë£Œ í—ˆìš©   |
| `shutdown.log`ì— ì¶”ê°€ ì •ë³´ ê¸°ë¡ | ì‚¬ìš©ì UID, PID ë“±                  |
| `syslog()`ë¡œ ì‹œìŠ¤í…œ ë¡œê·¸ ì—°ë™   | `/var/log/syslog`ì— ê¸°ë¡            |
| ë°±ê·¸ë¼ìš´ë“œ ë°ëª¬ìœ¼ë¡œ ì‹¤í–‰        | `fork()` í›„ detach (ì¶”í›„ êµ¬í˜„ ê°€ëŠ¥) |

------

### ğŸ§© ì •ë¦¬

| ê¸°ìˆ  ìš”ì†Œ               | ì ìš© ë‚´ìš©                   |
| ----------------------- | --------------------------- |
| `sigaction()`           | ì‹œê·¸ë„ ì²˜ë¦¬ ì„¤ì •            |
| `SIGINT`                | í•¸ë“¤ëŸ¬ì—ì„œ ë¬´ì‹œ ë©”ì‹œì§€ ì¶œë ¥ |
| `SIGTERM`               | ë¡œê·¸ íŒŒì¼ ê¸°ë¡ + ì •ìƒ ì¢…ë£Œ  |
| `ctime()`               | í˜„ì¬ ì‹œê°„ ë¬¸ìì—´ ìƒì„±       |
| `fopen()` / `fprintf()` | íŒŒì¼ ê¸°ë¡                   |

## ì‹œê·¸ë„ ê¸°ë°˜ IPC (ì‚¬ìš©ì ì •ì˜ ì‹œê·¸ë„)

### ê°œìš”

- **IPC(Inter-Process Communication)**: í”„ë¡œì„¸ìŠ¤ ê°„ì— ì •ë³´ë¥¼ ì£¼ê³ ë°›ëŠ” ê¸°ìˆ .
- ì‹œê·¸ë„ ê¸°ë°˜ IPCëŠ” **ì‹œê·¸ë„(SIGNAL)ì„ í†µí•´ í”„ë¡œì„¸ìŠ¤ ê°„ì— ì´ë²¤íŠ¸/ëª…ë ¹ì„ ì „ë‹¬**í•˜ëŠ” ê°„ë‹¨í•œ IPC ë°©ì‹.
- ì£¼ë¡œ **SIGUSR1 (10)** ì™€ **SIGUSR2 (12)** ë¥¼ ì‚¬ìš©ì ì •ì˜ ì‹œê·¸ë„ë¡œ ì‚¬ìš©.

### íŠ¹ì§•

| ì¥ì                     | ë‹¨ì                                                 |
| ----------------------- | --------------------------------------------------- |
| êµ¬í˜„ì´ ë§¤ìš° ê°„ë‹¨        | ë°ì´í„° ì „ë‹¬ì€ ë§¤ìš° ì œí•œì  (ê°’ X, ìƒíƒœë§Œ ì „ë‹¬)       |
| í”„ë¡œì„¸ìŠ¤ê°„ ë™ê¸°í™” ê°€ëŠ¥  | ë°ì´í„°ëŸ‰ ì „ë‹¬ ë¶ˆê°€ (ë‹¨, sigqueue ì´ìš© ì‹œ ì•½ê°„ ê°€ëŠ¥) |
| ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ê±°ì˜ ì—†ìŒ | ì‹ ë¢°ì„± ë‚®ìŒ (ì‹œê·¸ë„ ìœ ì‹¤ ê°€ëŠ¥ì„± ì¡´ì¬)               |

------

### í™œìš© ì‚¬ë¡€

- í”„ë¡œì„¸ìŠ¤ ìƒíƒœ ë³€ê²½ ìš”ì²­
- **ì„œë²„ wake-up, reload, pause ë“± ì´ë²¤íŠ¸ ì•Œë¦¼**
- **ê°„ë‹¨í•œ í”„ë¡œì„¸ìŠ¤ ì œì–´ìš© ì»¤ë§¨ë“œ ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„**
- **ë°ëª¬ ê´€ë¦¬** â†’ `kill -USR1 pid` / `kill -USR2 pid`

------

### 1ï¸âƒ£ SIGUSR1 / SIGUSR2 ë¥¼ ì´ìš©í•œ ê¸°ë³¸ IPC ì˜ˆì œ

#### ì„¤ê³„

- **ì„œë²„ í”„ë¡œì„¸ìŠ¤**: SIGUSR1, SIGUSR2 ìˆ˜ì‹  â†’ ìƒíƒœ ë³€ê²½
- **í´ë¼ì´ì–¸íŠ¸ í”„ë¡œì„¸ìŠ¤**: `kill -USR1 pid` / `kill -USR2 pid` ë¡œ ì´ë²¤íŠ¸ ì „ì†¡

------

### 2ï¸âƒ£ ì„œë²„ ì½”ë“œ ì˜ˆì œ

```
#include <stdio.h>
#include <signal.h>
#include <unistd.h>

volatile sig_atomic_t usr1_count = 0;
volatile sig_atomic_t usr2_count = 0;

void sigusr_handler(int signum) {
    if (signum == SIGUSR1) {
        usr1_count++;
    } else if (signum == SIGUSR2) {
        usr2_count++;
    }
}

int main() {
    struct sigaction sa;
    sa.sa_handler = sigusr_handler;
    sigemptyset(&sa.sa_mask);
    sa.sa_flags = SA_RESTART;

    sigaction(SIGUSR1, &sa, NULL);
    sigaction(SIGUSR2, &sa, NULL);

    printf("Signal IPC server running. PID: %d\n", getpid());
    printf("Send SIGUSR1 or SIGUSR2 to this process.\n");

    while (1) {
        printf("SIGUSR1 count: %d, SIGUSR2 count: %d\n", usr1_count, usr2_count);
        sleep(2);
    }

    return 0;
}
```

------

### 3ï¸âƒ£ í´ë¼ì´ì–¸íŠ¸ ì‚¬ìš©ë²•

```
$ ./signal_ipc_server
Signal IPC server running. PID: 12345
Send SIGUSR1 or SIGUSR2 to this process.
SIGUSR1 count: 0, SIGUSR2 count: 0

# ë‹¤ë¥¸ í„°ë¯¸ë„ì—ì„œ:

$ kill -SIGUSR1 12345
$ kill -SIGUSR1 12345
$ kill -SIGUSR2 12345
```

#### ì„œë²„ ì¶œë ¥ ë³€í™” ì˜ˆ:

```
SIGUSR1 count: 2, SIGUSR2 count: 1
```

------

### 4ï¸âƒ£ ê³ ê¸‰: sigqueue() ë¡œ ë°ì´í„° ì „ë‹¬

**sigqueue()** ë¥¼ ì´ìš©í•˜ë©´ **ì •ìˆ˜ ê°’ í•˜ë‚˜(4byte) ì •ë„ëŠ” í•¨ê»˜ ì „ë‹¬ ê°€ëŠ¥**.

#### API

```
int sigqueue(pid_t pid, int sig, const union sigval value);
```

- value.sival_int â†’ int ê°’ ì „ë‹¬ ê°€ëŠ¥.

#### ê³ ê¸‰ ì„œë²„ ì˜ˆì œ

```
#include <stdio.h>
#include <signal.h>
#include <unistd.h>

void sigusr_handler(int signum, siginfo_t *info, void *context) {
    if (signum == SIGUSR1) {
        printf("Received SIGUSR1 with value: %d\n", info->si_value.sival_int);
    }
}

int main() {
    struct sigaction sa;
    sa.sa_sigaction = sigusr_handler;
    sigemptyset(&sa.sa_mask);
    sa.sa_flags = SA_SIGINFO;

    sigaction(SIGUSR1, &sa, NULL);

    printf("Signal IPC server with data. PID: %d\n", getpid());

    while (1) {
        pause();
    }

    return 0;
}
```

#### í´ë¼ì´ì–¸íŠ¸ ì‚¬ìš©ë²• (Cì—ì„œ):

```
#include <stdio.h>
#include <stdlib.h>
#include <signal.h>
#include <unistd.h>

int main(int argc, char *argv[]) {
    if (argc != 3) {
        printf("Usage: %s <pid> <value>\n", argv[0]);
        return 1;
    }

    pid_t pid = atoi(argv[1]);
    int val = atoi(argv[2]);

    union sigval sval;
    sval.sival_int = val;

    sigqueue(pid, SIGUSR1, sval);

    return 0;
}
```

#### ì‹¤í–‰ íë¦„:

```
$ ./signal_ipc_server_with_data
Signal IPC server with data. PID: 12345

# í´ë¼ì´ì–¸íŠ¸ì—ì„œ:
$ ./signal_ipc_client 12345 999

# ì„œë²„ì—ì„œ ì¶œë ¥:
Received SIGUSR1 with value: 999
```

------

### 5ï¸âƒ£ ì •ë¦¬

| ì‹œê·¸ë„ ê¸°ë°˜ IPC ë°©ì‹ | íŠ¹ì§•                                                        |
| -------------------- | ----------------------------------------------------------- |
| SIGUSR1 / SIGUSR2    | ìƒíƒœ ì „ì´, ì´ë²¤íŠ¸ ì•Œë¦¼ì— ì í•©                               |
| sigqueue() + SIGUSR1 | ìƒíƒœ ì „ì´ + ê°„ë‹¨í•œ ë°ì´í„° ì „ë‹¬ ê°€ëŠ¥                         |
| ì£¼ì˜ì‚¬í•­             | ì‹œê·¸ë„ ìœ ì‹¤ ê°€ëŠ¥ì„± ìˆìŒ (ì‹œê·¸ë„ ì¬ì „ì†¡ ì‹œ ì¤‘ë³µ ê°€ëŠ¥ì„± ì£¼ì˜) |

**ì£¼ìš” í™œìš© ì˜ì—­**:

- **ì„œë²„ í”„ë¡œì„¸ìŠ¤ ì œì–´ (reload / stop / pause ë“±)**
- **ë°ëª¬ ê´€ë¦¬**
- **ê°„ë‹¨í•œ ì´ë²¤íŠ¸ ì•Œë¦¼ ì‹œìŠ¤í…œ**
- **Test, Debug ì‹œ ë¹ ë¥¸ ì»¤ë§¨ë“œ ì¸í„°í˜ì´ìŠ¤**

------

### ê²°ë¡ 

- ì‹œê·¸ë„ ê¸°ë°˜ IPCëŠ” ë§¤ìš° ê°€ë³ê³  ë¹ ë¥´ì§€ë§Œ **ë³µì¡í•œ ë°ì´í„° êµí™˜ìš©ìœ¼ë¡œëŠ” ì í•©í•˜ì§€ ì•Šë‹¤**.
- ì£¼ë¡œ:
  - **í”„ë¡œì„¸ìŠ¤ ìƒíƒœ ì „ì´**
  - **ê°„ë‹¨í•œ "wake up" ì´ë²¤íŠ¸**
  - **ì •ìƒ ì¢…ë£Œ ìš”ì²­**
  - **hot reload ë“± ëª…ë ¹ì–´ ì¸í„°í˜ì´ìŠ¤**
- ë¡œ ì‚¬ìš©í•˜ë©´ ìœ ìš©í•˜ë‹¤.
- **sigqueue()** ë¥¼ í†µí•´ ê¸°ë³¸ì ì¸ ì •ìˆ˜ ê°’ì€ í•¨ê»˜ ì „ë‹¬ ê°€ëŠ¥ â†’ ê³ ê¸‰ í•¸ë“¤ë§ ì‹œ ì‚¬ìš© ê°€ëŠ¥.

## íƒ€ì´ë¨¸ ê¸°ë°˜ ì¢…ë£Œ ì¡°ê±´ ì²˜ë¦¬ê¸°

ì´ë²ˆ ì˜ˆì œëŠ” **ì¼ì • ì‹œê°„(ì˜ˆ: 10ì´ˆ) í›„ SIGALRM ì‹œê·¸ë„ì„ ë°œìƒì‹œí‚¤ê³  â†’ ì»¤ìŠ¤í…€ í•¸ë“¤ëŸ¬ì—ì„œ ì¢…ë£Œ ì²˜ë¦¬**í•˜ëŠ” íŒ¨í„´ì´ì•¼.

#### ì£¼ìš” íŒ¨í„´

- `alarm()` ìœ¼ë¡œ Nì´ˆ í›„ SIGALRM ì˜ˆì•½
- `sigaction()` ìœ¼ë¡œ SIGALRM í•¸ë“¤ëŸ¬ ë“±ë¡
- í•¸ë“¤ëŸ¬ì—ì„œ **ì¢…ë£Œ ì¡°ê±´ ì²˜ë¦¬** + ì¢…ë£Œ ë¡œê·¸ ì¶œë ¥
- ë©”ì¸ ë£¨í”„ëŠ” ì •ìƒ ë™ì‘ ì¤‘ (alarm ë°œìƒí•˜ë©´ ì¢…ë£Œ)

------

### ğŸ“„ ì „ì²´ ì½”ë“œ ì˜ˆì œ: íƒ€ì´ë¨¸ ê¸°ë°˜ ì¢…ë£Œ ì¡°ê±´ ì²˜ë¦¬ê¸°

```
#include <stdio.h>
#include <signal.h>
#include <unistd.h>
#include <stdlib.h>
#include <time.h>

volatile sig_atomic_t stop = 0;

void sigalrm_handler(int signum) {
    // íƒ€ì´ë¨¸ ì¢…ë£Œ ì²˜ë¦¬
    printf("Timer expired! Shutting down.\n");
    stop = 1;
}

void log_shutdown() {
    FILE *log = fopen("timer_shutdown.log", "a");
    if (log == NULL) {
        perror("fopen");
        return;
    }

    time_t now = time(NULL);
    char *timestamp = ctime(&now);
    if (timestamp == NULL) {
        timestamp = "UNKNOWN TIME\n";
    }

    fprintf(log, "[TIMER_SHUTDOWN] %s", timestamp);
    fclose(log);
}

int main() {
    struct sigaction sa;
    sa.sa_handler = sigalrm_handler;
    sigemptyset(&sa.sa_mask);
    sa.sa_flags = SA_RESTART;

    sigaction(SIGALRM, &sa, NULL);

    printf("Program will automatically terminate after 10 seconds.\n");

    // 10ì´ˆ í›„ SIGALRM ë°œìƒ ì˜ˆì•½
    alarm(10);

    // ë©”ì¸ ë£¨í”„
    while (!stop) {
        printf("Running...\n");
        sleep(1);
    }

    // ì¢…ë£Œ ì²˜ë¦¬
    log_shutdown();
    printf("Shutdown complete. Exiting.\n");

    return 0;
}
```

------

### ğŸ§ª ì‹¤í–‰ íë¦„

```
$ gcc -o timer_shutdown timer_shutdown.c
$ ./timer_shutdown
Program will automatically terminate after 10 seconds.
Running...
Running...
Running...
...
Timer expired! Shutting down.
Shutdown complete. Exiting.
```

â†’ ì´í›„:

```
$ cat timer_shutdown.log
[TIMER_SHUTDOWN] Mon Jun 10 01:45:12 2025
```

------

### ğŸ“Œ êµ¬ì¡° ì„¤ëª…

| êµ¬ì„± ìš”ì†Œ                    | ì„¤ëª…                                         |
| ---------------------------- | -------------------------------------------- |
| `alarm(10)`                  | 10ì´ˆ í›„ SIGALRM ì˜ˆì•½                         |
| `sigaction(SIGALRM)`         | SIGALRM ìˆ˜ì‹  ì‹œ `sigalrm_handler()` í˜¸ì¶œ     |
| `volatile sig_atomic_t stop` | ì•ˆì „í•œ ì¢…ë£Œ ì¡°ê±´ ë³€ìˆ˜                        |
| `log_shutdown()`             | ì¢…ë£Œ ì‹œ íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë¡ (íŒŒì¼ ê¸°ë¡)          |
| ë©”ì¸ ë£¨í”„                    | stop flagê°€ 1 ë˜ê¸° ì „ê¹Œì§€ 1ì´ˆ ë‹¨ìœ„ ì‘ì—… ìˆ˜í–‰ |

------

### ğŸ›  ê³ ê¸‰ í™•ì¥ ì•„ì´ë””ì–´

| ê¸°ëŠ¥                         | ì„¤ëª…                                        |
| ---------------------------- | ------------------------------------------- |
| SIGUSR1 ìˆ˜ì‹  ì‹œ íƒ€ì´ë¨¸ ë¦¬ì…‹  | `alarm()` ì¬í˜¸ì¶œë¡œ ì¬íƒ€ì´ë¨¸ ê°€ëŠ¥            |
| SIGUSR2 ìˆ˜ì‹  ì‹œ íƒ€ì´ë¨¸ ì·¨ì†Œ  | `alarm(0)` í˜¸ì¶œ                             |
| ì‚¬ìš©ì ì§€ì • ì¢…ë£Œ ë©”ì‹œì§€ ê¸°ë¡ | SIGUSR1 ë“±ìœ¼ë¡œ ì¢…ë£Œ ë©”ì‹œì§€ ì§€ì • í›„ log ê¸°ë¡ |
| ë™ì  íƒ€ì´ë¨¸ ì‹œê°„ ì„¤ì •        | CLI ì¸ìë¡œ Nì´ˆ ì„¤ì • ë°›ì•„ì„œ alarm(N) ì‚¬ìš©    |

------

### ğŸš€ ì‹¤ì „ì—ì„œ í™œìš©ë˜ëŠ” íŒ¨í„´

- **Watchdog timer**: ì„œë²„/ë””ë°”ì´ìŠ¤ê°€ ì¼ì • ì‹œê°„ ì´ìƒ ì‘ë‹µ ì—†ì„ ì‹œ ìë™ ì¢…ë£Œ.
- **Idle timeout**: ì„œë¹„ìŠ¤ê°€ ì¼ì • ì‹œê°„ ë™ì•ˆ activity ì—†ìœ¼ë©´ ì¢…ë£Œ.
- **Test timeout**: ìë™ í…ŒìŠ¤íŠ¸ ì‹œ ì¼ì • ì‹œê°„ ì´ìƒ ê±¸ë¦¬ë©´ timeout fail ì²˜ë¦¬.

------

### ê²°ë¡ 

- `alarm()` + `sigaction()` + stop flag ì¡°í•©ì€ **íƒ€ì´ë¨¸ ê¸°ë°˜ ì¢…ë£Œ ì²˜ë¦¬ì˜ í‘œì¤€ íŒ¨í„´**ì´ë‹¤.
- ë°˜ë“œì‹œ:
  - **í•¸ë“¤ëŸ¬ëŠ” ë‹¨ìˆœí™”** (stop flag ì„¤ì •ë§Œ ë‹´ë‹¹)
  - ë©”ì¸ ë£¨í”„ì—ì„œ **ì •ìƒ ì¢…ë£Œ ê²½ë¡œë¥¼ êµ¬í˜„** â†’ "graceful shutdown" ê°€ëŠ¥.
- ì‹¤ì „ì—ì„œëŠ”:
  - SIGUSR1/SIGUSR2ë¡œ **íƒ€ì´ë¨¸ ì œì–´ ì¸í„°í˜ì´ìŠ¤ ì¶”ê°€** â†’ ë” ìœ ì—°í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŒ.